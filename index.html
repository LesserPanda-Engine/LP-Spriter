<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spriter Scon Runtime</title>
</head>
<body>
  <script src="pixi.js"></script>
  <script src="spriter.js"></script>

  <canvas id="canvas"></canvas>

  <script>
    var renderDebugData = false;
    var renderDebugPose = false;

    var data = new spriter.Data();
    var pose = new spriter.Pose(data);

    function sconMiddleWare(res, next) {
      if (res.url.match(/\.scon$/)) {
          // console.log('%s is scon', res.url);
          var path = res.url.replace(/[^\/]*$/, '');
          var atlasUrl = res.url.replace(/\.scon$/, '.json');
          // console.log(atlasUrl);
          PIXI.loader.add(atlasUrl);
          loadScon(res.data);
        }
        next();
    }

    function loadScon(sconStr) {
      var scon = JSON.parse(sconStr);
      // Load scon data
      data.load(scon);

      // Set entity and animation
      var entityKeys = pose.getEntityKeys();
      pose.setEntity(entityKeys[0]);

      var animKeys = pose.getAnimKeys();
      pose.setAnim(animKeys[0]);
    }

    PIXI.loader
      .add('GreyGuy/player.scon')
      .after(sconMiddleWare)
      .once('complete', start)
      .load();

    function start() {
      var renderer = PIXI.autoDetectRenderer(600, 400, {
        view: document.querySelector('#canvas')
      });
      var stage = new PIXI.Container();

      function render() {
        requestAnimationFrame(render);

        renderer.render(stage);
      }
    }
  </script>
</body>
</html>
